<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - AgroMind</title>
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f0f4f0; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: white; padding: 2.5rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; width: 350px; }
        h2 { color: #2e7d32; margin-top: 0; }
        p { color: #555; margin-bottom: 2rem; }
        input { width: 100%; padding: 0.8rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 0.8rem; border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; }
        #registerBtn { background: #4caf50; }
        #detectLocationBtn { background: #1e88e5; margin-bottom: 1rem; }
        a { color: #2e7d32; text-decoration: none; margin-top: 1.5rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="card">
        <form id="registerForm">
            <h2>Create Your Account</h2>
            <p>Get started with AgroMind.</p>
            <input type="text" id="name" placeholder="Your Full Name" required>
            <input type="text" id="username" placeholder="Choose a Username" required>
            <input type="password" id="password" placeholder="Enter password" required>
            <div class="input-group">
                <label for="language">Preferred Language</label>
                <select id="language">
                     <option value="en-IN">English</option>
                    <option value="hi-IN">Hindi (हिन्दी)</option>
                    <option value="bn-IN">Bengali (বাংলা)</option>
                    <option value="gu-IN">Gujarati (ગુજરાતી)</option>
                    <option value="kn-IN">Kannada (ಕನ್ನಡ)</option>
                    <option value="ml-IN">Malayalam (മലയാളം)</option>
                    <option value="mr-IN">Marathi (मराठी)</option>
                    <option value="or-IN">Odia (ଓଡ଼ିଆ)</option>
                    <option value="pa-IN">Punjabi (ਪੰਜਾਬੀ)</option>
                    <option value="ta-IN">Tamil (தமிழ்)</option>
                    <option value="te-IN">Telugu (తెలుగు)</option>
                </select>
            </div>
            <button style="margin-top: 13px;" type="button" id="detectLocationBtn">Detect My Location</button>
            <input type="text" id="region" placeholder="Region (e.g., Jaipur, Rajasthan)" required>
            
            <button type="submit" id="registerBtn">Register</button>
        </form>
        <a href="./login.html">Already have an account? Login</a>
    </div>
    <script>
        const weatherApiKey = 'b30eadbb0838febfef991a51034da9ef';  //edc27de259d65f2014e94450a87d4a09

        document.getElementById('detectLocationBtn').addEventListener('click', () => {
            if (!weatherApiKey || weatherApiKey === 'YOUR_OPENWEATHERMAP_API_KEY') {
                return alert('Please add your OpenWeatherMap API key to the script first.');
            }
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    try {
                        const response = await fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${position.coords.latitude}&lon=${position.coords.longitude}&limit=1&appid=${weatherApiKey}`);
                        const data = await response.json();
                        if (data && data.length > 0) {
                            const location = data[0];
                            document.getElementById('region').value = `${location.name}, ${location.state || location.country}`;
                        } else { alert('Could not determine your location name.'); }
                    } catch (error) { alert('Error fetching location name.'); }
                }, () => { alert('Unable to retrieve your location. Please grant permission.'); });
            } else { alert('Geolocation is not supported by this browser.'); }
        });
        
        document.getElementById('registerForm').addEventListener('submit', async (event) => {
    event.preventDefault();
    const form = event.target;
    const nameInput = document.getElementById('name');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const languageInput = document.getElementById('language');
    const regionInput = document.getElementById('region');

    if (nameInput.value.trim() === '' || usernameInput.value.trim() === '') {
        return alert('Please enter your full name and a username.');
    }

    const formData = {
        name: nameInput.value,
        username: usernameInput.value,
        password: passwordInput.value,
        language: languageInput.value,
        region: regionInput.value,
    };

    try {
        const response = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });
        const data = await response.json();

        if (response.ok) {
            // Successful registration → redirect to login page
            alert('Registration Successful')
            window.location.href = '/login.html'; // change path if your login page is different
        } else {
            // Failed registration → show error alert
            alert('Registration failed: ' + (data.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Registration Fetch Error:', error);
        alert('An error occurred. Please check the console.');
    }
});

    </script>
</body>
</html>